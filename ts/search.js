(()=>{var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function f(c){return m[c]||c}function d(c){return c.replace(/[&<>"]/g,f)}function w(c){return c.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var g=class c{data;form;input;list;resultTitle;resultTitleTemplate;constructor({form:t,input:e,list:r,resultTitle:a,resultTitleTemplate:n}){this.form=t,this.input=e,this.list=r,this.resultTitle=a,this.resultTitleTemplate=n,this.input.value.trim()!==""?this.doSearch(this.input.value.split(" ")):this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}static processMatches(t,e,r=!0,a=140,n=20){e.sort((i,l)=>i.start-l.start);let h=0,s=0,o=0,u=[];for(;h<e.length;){let i=e[h];r&&i.start-n>s?(u.push(`${d(t.substring(s,s+n))} [...] `),u.push(`${d(t.substring(i.start-n,i.start))}`),o+=n*2):(u.push(d(t.substring(s,i.start))),o+=i.start-s);let l=h+1,p=i.end;for(;l<e.length&&e[l].start<=p;)p=Math.max(e[l].end,p),++l;if(u.push(`<mark>${d(t.substring(i.start,p))}</mark>`),o+=p-i.start,h=l,s=p,r&&o>a)break}if(s<t.length){let i=t.length;r&&(i=Math.min(i,s+n)),u.push(`${d(t.substring(s,i))}`),r&&i!=t.length&&u.push(" [...]")}return u.join("")}async searchKeywords(t){let e=await this.getData(),r=[],a=new RegExp(t.filter((n,h,s)=>(s[h]=w(n),n.trim()!=="")).join("|"),"gi");for(let n of e){let h=[],s=[],o={...n,preview:"",matchCount:0},u=n.content.matchAll(a);for(let l of Array.from(u))s.push({start:l.index,end:l.index+l[0].length});let i=n.title.matchAll(a);for(let l of Array.from(i))h.push({start:l.index,end:l.index+l[0].length});h.length>0&&(o.title=c.processMatches(o.title,h,!1)),s.length>0?o.preview=c.processMatches(o.content,s):o.preview=d(o.content.substring(0,140)),o.matchCount=h.length+s.length,o.matchCount>0&&r.push(o)}return r.sort((n,h)=>h.matchCount-n.matchCount)}async doSearch(t){let e=performance.now(),r=await this.searchKeywords(t);this.clear();for(let n of r)this.list.append(c.render(n));let a=performance.now();this.resultTitle.innerText=this.generateResultTitle(r.length,((a-e)/1e3).toPrecision(1))}generateResultTitle(t,e){return this.resultTitleTemplate.replace("#PAGES_COUNT",t).replace("#TIME_SECONDS",e)}async getData(){if(!this.data){let t=this.form.dataset.json;this.data=await fetch(t).then(r=>r.json());let e=new DOMParser;for(let r of this.data)r.content=e.parseFromString(r.content,"text/html").body.innerText}return this.data}bindSearchForm(){let t="",e=r=>{r.preventDefault();let a=this.input.value.trim();if(c.updateQueryString(a,!0),a==="")return t="",this.clear();t!==a&&(t=a,this.doSearch(a.split(" ")))};this.input.addEventListener("input",e),this.input.addEventListener("compositionend",e)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",t=>{this.handleQueryString()})}handleQueryString(){let e=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=e,e?this.doSearch(e.split(" ")):this.clear()}static updateQueryString(t,e=!1){let r=new URL(window.location.toString());t===""?r.searchParams.delete("keyword"):r.searchParams.set("keyword",t),e?window.history.replaceState("","",r.toString()):window.history.pushState("","",r.toString())}static render(t){return createElement("article",null,createElement("a",{href:t.permalink,title:`Read: ${t.title}`},createElement("div",{class:"card mb-3 border-0"},createElement("div",{class:"row g-0"},createElement("div",{class:"col-md-1"},createElement("h4",{class:"ms-3 mb-1"},createElement("span",{class:"mx-1"},t.webpImage&&t.fallbackImage?createElement("picture",null,createElement("source",{srcSet:t.webpImage,type:"image/webp"}),createElement("img",{src:t.fallbackImage,alt:t.title,width:"50",height:"50",onError:e=>{let a=e.target.closest("picture");a&&(a.style.display="none")}})):null),createElement("span",null,t.title))),createElement("div",{class:"col-md-11"},createElement("div",{class:"card-body d-flex flex-column justify-content-center h-100"},createElement("div",{dangerouslySetInnerHTML:{__html:t.preview}})))))))}};window.addEventListener("load",()=>{setTimeout(function(){let c=document.querySelector(".search-form"),t=c.querySelector("input"),e=document.querySelector(".search-result--list"),r=document.querySelector(".search-result--title");new g({form:c,input:t,list:e,resultTitle:r,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var v=g;})();
