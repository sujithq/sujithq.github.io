{{ define "main" }}
<div class="container">

<div class="row g-0">
  <div class="col-lg-12">
    <div class="card border-primary col-lg-12">
      <div class="card-body">
        <div class="container mt-0">
          <div class="d-flex gap-1 flex-wrap">
            <h2><button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCategory" aria-expanded="false" aria-controls="collapseCategory">
    Browse by category
  </button></h2>
  <h2><button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTags" aria-expanded="false" aria-controls="collapseTags">
    Browse by tags
  </button></h2>
  <h2><button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTimeframes" aria-expanded="false" aria-controls="collapseTimeframes">
    Browse by timeframe
  </button></h2>
          </div>

            <div class="collapse" id="collapseCategory">

  <div class="d-flex gap-1 flex-wrap">
        {{- range $term, $pagesForTerm := .Site.Taxonomies.update_categories -}}
          {{ $tp := where $pagesForTerm "Section" "updates2" }}
          {{ $tp = where $tp ".Params.unlisted" "!=" true }}
          {{ $count := len $tp }}
          <a href="{{ (site.GetPage (printf "/update_categories/%s" (urlize $term))).RelPermalink }}"><span class="badge rounded-pill bg-primary fs-5 mx-1">{{ $term }}<span class="badge rounded-pill text-bg-danger mx-1 m-0">{{ $count }}</span></span></a>
        {{- end -}}
    </div>
            </div>


  <div class="collapse" id="collapseTags">
    <div class="d-flex gap-1 flex-wrap">
        {{- range $term, $pagesForTerm := .Site.Taxonomies.update_tags -}}
          {{ $tp := where $pagesForTerm "Section" "updates2" }}
          {{ $tp = where $tp ".Params.unlisted" "!=" true }}
          {{ $count := len $tp }}
          <a href="{{ (site.GetPage (printf "/update_tags/%s" (urlize $term))).RelPermalink }}"><span class="badge rounded-pill bg-secondary fs-5 mx-1">{{ $term }}<span class="badge rounded-pill text-bg-danger mx-1 m-0">{{ $count }}</span></span></a>
        {{- end -}}
    </div>
    </div>


  <div class="collapse" id="collapseTimeframes">
    <div class="d-flex gap-1 flex-wrap">
        {{- range $term, $pagesForTerm := .Site.Taxonomies.timeframes -}}
          {{ $tp := where $pagesForTerm "Section" "updates2" }}
          {{ $tp = where $tp ".Params.unlisted" "!=" true }}
          {{ $count := len $tp }}
          <a href="{{ (site.GetPage (printf "/timeframes/%s" (urlize $term))).RelPermalink }}"><span class="badge rounded-pill bg-info text-dark fs-5 mx-1">{{ $term }}<span class="badge rounded-pill text-bg-danger mx-1 m-0">{{ $count }}</span></span></a>
        {{- end -}}
    </div>
    </div>
        </div>
      </div>
    </div>
  </div>
</div>




  {{/* Collect all visible update pages */}}
  {{ $pages := where (where site.RegularPages "Section" "updates2") ".Params.unlisted" "!=" true }}

  {{/* Allow custom page size via site param, fallback to 15 (different from posts page size) */}}
  {{ $defaultUpdatePageSize := 10 }}
  {{ $updatePageSize := or site.Params.updatesPageSize $defaultUpdatePageSize }}

  {{/* Create paginator with custom size */}}
  {{ $paginator := .Paginate $pages $updatePageSize }}
  {{ $title := printf "%s page %d" .Title $paginator.PageNumber }}

  {{/* Pass only the current page's pages to archive partial so grouping reflects current page subset */}}
  {{ $pageItems := $paginator.Pages }}
  {{ partial "updates2-archive.html" (dict
    "pages" $pageItems
    "title" $title
    "showIcon" false
  ) }}

  <div class="row g-0">
    <div class="col-lg-12 d-flex justify-content-center">
      {{ partial "pagination.html" (dict "paginator" $paginator) }}
    </div>
  </div>
  </div>
{{ end }}
