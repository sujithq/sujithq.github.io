{{ define "main" }}

{{ $defaultPageSize := 4 }} <!-- Default number of posts per page -->
{{ $pageSize := $defaultPageSize }}

<div class="container">
  <div class="row">
    <div class="col-lg">
      <h1>Welcome to My Blog: Navigating Azure, GitHub, and DevOps Challenges ðŸš€</h1>
      <p class="lead">Join me on a journey through the world of Azure, GitHub, and DevOps as I share insights, solutions, and experiences to help you overcome challenges and achieve success. Opinions are my own.</p>
    </div>
  </div>
  <div class="row mt-1">
    <div class="col-lg-9">
      {{ $posts := where site.RegularPages "Section" "posts" }}
      {{ $sortedPosts := $posts.ByLastmod.Reverse }}

      {{/* We need Hugo to create pagination structure, so use original posts for pagination */}}
      {{ $paginator := .Paginate $posts $pageSize }}

      {{/* Now override with our sorted posts for the current page */}}
      {{ $currentPage := $paginator.PageNumber }}
      {{ $totalPosts := len $sortedPosts }}
      {{ $startIndex := mul (sub $currentPage 1) $pageSize }}
      {{ $endIndex := add $startIndex $pageSize }}

      {{/* Get posts for current page while preserving lastmod sort order */}}
      {{ $pages := slice }}
      {{ range $index, $post := $sortedPosts }}
        {{ if and (ge $index $startIndex) (lt $index $endIndex) }}
          {{ $pages = $pages | append $post }}
        {{ end }}
      {{ end }}

      {{ $total := len $pages }}
      {{ $index := 0 }}  {{/* Manual index tracking */}}
      {{ range seq 0 (sub $total 1) }}  {{/* Iterate manually */}}
        {{ if ge $index $total }}  {{/* Stop if index exceeds total pages */}}
          {{ break }}
        {{ end }}
        {{ $page := index $pages $index }}
        {{ if eq $index 0 }}
          {{ partial "blog/one.html" (dict "page" $page "showTaxonomy" false) }}
          {{ $index = add $index 1 }}  {{/* Move to the next page */}}
        {{ else if eq $index 1 }}
          {{ partial "blog/two" (dict "page" $page "index" $index "pages" $pages) }}
          {{ $index = add $index 2 }}  {{/* Skip 2 items and continue with the next loop */}}
        {{ else if eq $index 3 }}
          {{ partial "blog/one.html" (dict "page" $page "showTaxonomy" false) }}
          {{ $index = add $index 1 }}  {{/* Move to the next page */}}
        {{ end }}
      {{ end }}
    </div>
    <div class="col-lg-3 sidebar ps-lg-3">
      {{ partial "sidebar.html" (dict "page" .) }}
    </div>
  </div>
  <div class="row">
    <div class="col-lg-9 d-flex justify-content-center">
      {{/* Use the theme's pagination partial with our paginator */}}
      {{ partial "pagination.html" (dict "paginator" $paginator) }}
    </div>
  </div>
</div>
{{ end }}
