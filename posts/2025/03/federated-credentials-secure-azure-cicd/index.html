<!doctype html><html lang=en-us dir=ltr data-bs-theme=light tabindex=0><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>üìò Secure Azure CI/CD with Federated Credentials</title><meta name=keywords content="Azure,GitHub Actions,Azure DevOps,Federated Identity,Security,CI-CD,Authentication"><meta name=description content="Learn how federated credentials enhance security and simplify authentication in GitHub Actions and Azure DevOps by eliminating stored secrets in pipelines."><meta name=author content="Sujith Quintelier"><meta name=robots content="index,follow"><meta property="og:title" content="üìò Secure Azure CI/CD with Federated Credentials"><meta property="og:description" content="Learn how federated credentials enhance security and simplify authentication in GitHub Actions and Azure DevOps by eliminating stored secrets in pipelines."><meta property="og:image" content="https://quintelier.dev/posts/2025/03/federated-credentials-secure-azure-cicd/cover.jpg"><meta property="og:url" content="https://quintelier.dev/posts/2025/03/federated-credentials-secure-azure-cicd/"><meta property="og:type" content='"post"'><meta property="og:site_name" content="Sujith Quintelier"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="üìò Secure Azure CI/CD with Federated Credentials"><meta name=twitter:description content="Learn how federated credentials enhance security and simplify authentication in GitHub Actions and Azure DevOps by eliminating stored secrets in pipelines."><meta name=twitter:image content="https://quintelier.dev/posts/2025/03/federated-credentials-secure-azure-cicd/cover.jpg"><meta name=twitter:site content="@sujithq"><meta name=twitter:image:alt content="Learn how federated credentials enhance security and simplify authentication in GitHub Actions and Azure DevOps by eliminating stored secrets in pipelines."><meta name=theme-color content="#6a1d57"><link rel=canonical href=https://quintelier.dev/posts/2025/03/federated-credentials-secure-azure-cicd/><link rel=alternate type=application/rss+xml title="RSS Feed" href=https://quintelier.dev/index.xml><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=/android-chrome-512x512.png><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel="shortcut icon" href=/favicon.ico><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href=/scss/posts.min.3bf9c567d49448a6e4f2d33c8dcfe57244b19008886bbf74b789a15c935cfbf7.css integrity="sha256-O/nFZ9SUSKbk8tM8jc/lckSxkAiIa790t4mhXJNc+/c="><link rel=stylesheet href=/vendor/aos/css/aos.min.a30d75de86924b3a6a4e5a355506e6e3b5db77f7ed32f24c06c739e9236dbcf3.css integrity="sha256-ow113oaSSzpqTlo1VQbm47Xbd/ftMvJMBsc56SNtvPM="><link rel=stylesheet href=/vendor/swiper/css/swiper-bundle.min.min.ab0befab6e94ea5ce6c0050f9723206b76bc80117a1aca7c2a978672b2d23b17.css integrity="sha256-qwvvq26U6lzmwAUPlyMga3a8gBF6Gsp8KpeGcrLSOxc="><link rel=stylesheet href=/vendor/prismjs/css/prism-solarizedlight.min.2ebe3d0f213efcab2d9cb741c6a641a03620362e8e35f672019c372c387107d2.css integrity="sha256-Lr49DyE+/KstnLdBxqZBoDYgNi6ONfZyAZw3LDhxB9I="><script>(function(){let e=localStorage.getItem("theme")||document.documentElement.getAttribute("data-bs-theme")||"light";document.documentElement.setAttribute("data-bs-theme",e)})()</script><style>.cc-banner{position:fixed;bottom:0;left:0;right:0;z-index:2147483646;display:none;box-sizing:border-box;padding:1rem;border-top:1px solid rgba(0,0,0,.1);border-bottom:1px solid rgba(0,0,0,.1);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#111;color:#f1f1f1}.cc-inner{max-width:980px;margin:0 auto;display:flex;gap:.75rem;align-items:center}.cc-text{flex:auto}.cc-actions{display:flex;gap:.5rem;flex-wrap:wrap}.cc-btn{cursor:pointer;border:1px solid transparent;padding:.5rem .8rem;border-radius:.375rem;font-weight:600}.cc-btn-primary{background:#e6e6e6;color:#111}.cc-btn-secondary{background:0 0;border-color:#444;color:#ddd}.cc-link{text-decoration:underline;color:#c9e3ff}</style><div id=cc-banner class=cc-banner role=dialog aria-live=polite aria-label="Cookie consent"><div class=cc-inner><div class=cc-text>This site uses cookies for analytics via Microsoft Clarity. We only enable it after your consent.
See our <a class=cc-link href=/privacy/ rel=nofollow>Privacy Policy</a>.</div><div class=cc-actions><button id=cc-accept class="cc-btn cc-btn-primary" aria-label="Accept analytics cookies">Accept</button>
<button id=cc-decline class="cc-btn cc-btn-secondary" aria-label="Decline analytics cookies">Decline</button></div></div></div><script>(function(){var i='"rf5ih14aps"',a='"clarityConsent"',r=!0,e=!1,t=(""+i).replace(/^['"]+|['"]+$/g,""),n=(""+a).replace(/^['"]+|['"]+$/g,"");if(e){window.dataLayer=window.dataLayer||[];function c(){dataLayer.push(arguments)}c("consent","default",{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied",functionality_storage:"denied",personalization_storage:"denied",security_storage:"granted"})}function s(){if(!t)return;(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script",t)}function o(t){try{localStorage.setItem(n,t?"yes":"no")}catch{}if(t){if(e){function o(){dataLayer.push(arguments)}o("consent","update",{analytics_storage:"granted",functionality_storage:"granted"})}s(),typeof clarity=="function"&&clarity("consent","yes")}else{if(e){function o(){dataLayer.push(arguments)}o("consent","update",{analytics_storage:"denied",functionality_storage:"denied"})}typeof clarity=="function"&&clarity("consent","no")}}function l(){if(!r)return;var t,e=null;try{e=localStorage.getItem(n)}catch{}if(e==="yes"){s(),typeof clarity=="function"&&clarity("consent","yes");return}if(e==="no"){typeof clarity=="function"&&clarity("consent","no");return}t=document.getElementById("cc-banner"),t&&(t.style.display="block")}document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("cc-accept"),n=document.getElementById("cc-decline"),e=document.getElementById("cc-banner");t&&t.addEventListener("click",function(){o(!0),e&&(e.style.display="none")}),n&&n.addEventListener("click",function(){o(!1),e&&(e.style.display="none")}),l()})})()</script></head><body><header id=header class="header sticky-top"><nav class="navbar navbar-expand-lg fixed-top bg-primary navbar-transparent" data-bs-theme=dark><div class="container mt-0"><a class=navbar-brand href=/>Sujith Quintelier</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav data-bs-theme=dark><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/resume/>Resume</a></li><li class=nav-item><a class=nav-link href=/posts/>Archives</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=/ data-bs-toggle=dropdown>Taxonomy</a><ul class=dropdown-menu><li><a class=dropdown-item href=/tags/>Tags</a></li><li><a class=dropdown-item href=/categories/>Categories</a></li><li><a class=dropdown-item href=/series/>Series</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=/ data-bs-toggle=dropdown>Tools</a><ul class=dropdown-menu><li><a class=dropdown-item href=/tools/cidr-calculator/>CIDR Calculator</a></li><li><a class=dropdown-item href=/tools/cert-renewal/>Azure Certification Renewal</a></li><li><a class=dropdown-item href=/tools/tech-radar/>Tech Radar</a></li></ul></li><li class=nav-item><a class=nav-link href=/updates/>Updates</a></li></ul><ul class="navbar-nav ms-lg-auto align-items-lg-center"><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://www.linkedin.com/in/sujithquintelier/><i class="fab fa-linkedin"></i><span class="d-lg-none ms-2">linkedin</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://github.com/sujithq/><i class="fab fa-github"></i><span class="d-lg-none ms-2">github</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://x.com/SujithQ/><i class="fab fa-x-twitter"></i><span class="d-lg-none ms-2">twitter</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://mastodon.social/@sujithq><i class="fab fa-mastodon"></i><span class="d-lg-none ms-2">mastodon</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://bsky.app/profile/sujithq.bsky.social><i class="fa-brands fa-bluesky"></i><span class="d-lg-none ms-2">bsky</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://www.facebook.com/sujith.quintelier/><i class="fab fa-facebook"></i><span class="d-lg-none ms-2">facebook</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://www.instagram.com/sujithquintelier/><i class="fab fa-instagram"></i><span class="d-lg-none ms-2">instagram</span></a></li><li class=nav-item><a target=_blank rel=noopener class="nav-link d-flex align-items-center" href=https://www.buymeacoffee.com/sujithq><i class="fa fa-mug-hot"></i><span class="d-lg-none ms-2">buymeacoffee</span></a></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2 text-white-50"></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle d-flex align-items-center" href=# id=theme-menu aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme"><i class="fas fa-adjust"></i>
<span class="d-lg-none ms-2">Toggle theme</span></a><ul class="dropdown-menu dropdown-menu-end"><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<i class="fas fa-sun"></i><span class=ms-2>Light</span></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=true>
<i class="fas fa-moon"></i><span class=ms-2>Dark</span></button></li></ul></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2 text-white-50"></li><li class=nav-item><form class="d-flex search-form align-items-center" action=/search/ data-bs-theme=dark><input name=keyword class="form-control me-2" type=search placeholder=keywords>
<button title=Search class="btn btn-secondary" type=submit>
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button></form></li></ul></div></div></nav></header><main class=main><div class=container><div class="row mt-5"><div class="col-lg mt-3"><a href=https://quintelier.dev/><i class="fas fa-arrow-left mx-1"></i>All posts</a><div class=text-center><span class=mx-1>Written by</span>
<span><a href=/resume/>Sujith Quintelier</a>
</span><span class=mx-1>‚Ä¢</span>
<span>Mar 25, 2025</span></div><h1 class=text-center><strong>üìò Secure Azure CI/CD with Federated Credentials</strong></h1><div class="card border-0 mt-3 mb-3"><div class=text-center><picture><source srcset=/posts/2025/03/federated-credentials-secure-azure-cicd/cover_hu_c8cbcf7409a6a68d.webp type=image/webp><img src=/posts/2025/03/federated-credentials-secure-azure-cicd/cover_hu_85372a4bcfd50076.jpg alt="Learn how federated credentials enhance security and simplify authentication in GitHub Actions and Azure DevOps by eliminating stored secrets in pipelines." class="img-fluid rounded" loading=lazy></picture></div><div class="text-center mt-3"><div class="d-flex flex-wrap gap-0 w-100 justify-content-start justify-content-md-center rounded share-actions" role=group aria-label=Share><button type=button class="btn resp-sharing-button--facebook"><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-facebook"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--twitter"><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-x-twitter"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--tumblr"><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;caption=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;content=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;canonicalUrl=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;shareSource=tumblr_share_button" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-square-tumblr"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--email"><a class=resp-sharing-button__link href="mailto:?subject=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;body=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fas fa-envelope"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--pinterest"><a class=resp-sharing-button__link href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;media=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;description=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-pinterest"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--linkedin"><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;summary=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;source=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-linkedin"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--reddit"><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;resubmit=true&amp;title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-reddit"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--xing"><a class=resp-sharing-button__link href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f;title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-square-xing"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--whatsapp"><a class=resp-sharing-button__link href="whatsapp://send?text=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials%20https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-whatsapp"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--hackernews"><a class=resp-sharing-button__link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&amp;t=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-square-hacker-news"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--vk"><a class=resp-sharing-button__link href="http://vk.com/share.php?title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--vk resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-vk"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--telegram"><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&amp;url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fab fa-telegram"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--flipboard"><a class=resp-sharing-button__link href="https://share.flipboard.com/bookmarklet/popout?v=2&title=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials&url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--flipboard resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-flipboard"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--pocket"><a class=resp-sharing-button__link href="https://getpocket.com/save?url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--pocket resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-get-pocket"></i></div></div></a></button>
<button type=button class="btn resp-sharing-button--buffer"><a class=resp-sharing-button__link href="https://bufferapp.com/add?url=https%3a%2f%2fquintelier.dev%2fposts%2f2025%2f03%2ffederated-credentials-secure-azure-cicd%2f&text=%f0%9f%93%98%20Secure%20Azure%20CI%2fCD%20with%20Federated%20Credentials" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--buffer resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-buffer"></i></div></div></a></button></div></div><div class=card-body><div class="d-flex align-items-center"><span>Mar 25, 2025</span></div><div><h2 id=why-use-federated-credentials-in-cicd-pipelines>Why Use Federated Credentials in CI/CD Pipelines?</h2><p>In DevOps, protecting credentials and preventing secret sprawl across CI/CD systems like GitHub Actions and Azure DevOps is crucial. Federated credentials provide a secure way to authenticate pipelines without storing sensitive information, reducing the risk of exposure and simplifying secret management.</p><p>Federated identity leverages external identity providers (such as Azure Active Directory) to authenticate users and applications securely. Rather than managing multiple secrets or tokens across platforms, federated identity centralizes authentication, providing significant security and operational benefits.</p><h3 id=benefits-of-using-federated-credentials-in-cicd-pipelines>Benefits of Using Federated Credentials in CI/CD Pipelines</h3><h4 id=1-eliminate-secrets-in-pipelines>1Ô∏è‚É£ Eliminate Secrets in Pipelines</h4><p>Federated credentials eliminate the need to store sensitive secrets directly within pipeline configurations, significantly reducing the attack surface.</p><h4 id=2-centralized-identity-management>2Ô∏è‚É£ Centralized Identity Management</h4><p>Using a centralized identity provider simplifies user and app authentication across multiple CI/CD platforms, reducing administrative overhead.</p><h4 id=3-enhanced-security>3Ô∏è‚É£ Enhanced Security</h4><p>Federated authentication allows leveraging advanced security measures such as Multi-Factor Authentication (MFA), conditional access, and identity protection offered by Azure AD.</p><h4 id=4-simplified-secret-rotation>4Ô∏è‚É£ Simplified Secret Rotation</h4><p>Federated identities use short-lived, auto-rotated tokens, simplifying credential rotation processes and reducing the risk of credential leaks.</p><h4 id=5-improved-compliance-and-auditability>5Ô∏è‚É£ Improved Compliance and Auditability</h4><p>Centralized identity providers offer robust auditing and compliance capabilities, making it easier to track authentication events and meet regulatory requirements.</p><h4 id=6-reduced-administrative-effort>6Ô∏è‚É£ Reduced Administrative Effort</h4><p>By avoiding direct secret management, teams save considerable time and reduce potential human errors in handling credentials.</p><h4 id=7-better-collaboration>7Ô∏è‚É£ Better Collaboration</h4><p>Federated identity streamlines collaboration across teams and organizations by enabling secure and seamless access management through unified authentication.</p><h4 id=8-future-proof-authentication>8Ô∏è‚É£ Future-Proof Authentication</h4><p>Federated identity solutions scale efficiently and adapt easily to evolving security requirements and organizational growth.</p><hr><h2 id=implementing-federated-identity-in-github-and-azure-devops>Implementing Federated Identity in GitHub and Azure DevOps</h2><h3 id=github-actions-integration>GitHub Actions Integration</h3><p>Federated identity can be integrated directly into GitHub Actions workflows through Azure AD&rsquo;s OIDC provider. This allows pipelines to securely authenticate to Azure without maintaining any secrets in GitHub.</p><p>Below are clear guidelines to integrate federated credentials using either an <strong>Azure AD App Registration</strong> or an <strong>Azure Managed Identity</strong>. Each method includes complete scripts and GitHub workflows.</p><h4 id=github---method-1-azure-ad-app-registration>GitHub - Method 1: Azure AD App Registration</h4><h5 id=github---create-azure-ad-application-with-federated-credential>GitHub - Create Azure AD Application with Federated Credential</h5><p>This script automates the setup of an <strong>Azure AD App Registration</strong> with federated identity, enabling <strong>GitHub Actions</strong> workflows to securely authenticate to Azure without storing any secrets.</p><p><strong>Detailed Steps:</strong></p><p><strong>1Ô∏è‚É£ Define Variables</strong></p><p>These variables should be customized with your details:</p><ul><li><code>AZURE_SUBSCRIPTION_ID</code>: Azure subscription ID for resource access.</li><li><code>GH_ORG</code>: GitHub organization or username.</li><li><code>GH_REPO</code>: GitHub repository name.</li><li><code>GH_BRANCH</code>: Repository branch authorized for authentication (typically <code>main</code>).</li></ul><p><strong>2Ô∏è‚É£ Create Azure AD Application and Assign RBAC Role</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad sp create-for-rbac --role<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Contributor&#34;</span> --scopes<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/subscriptions/</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.appId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenant&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li>Uses Azure CLI to create an Azure AD <strong>Service Principal (App Registration)</strong>.</li><li>Automatically assigns the <code>Contributor</code> role scoped to your Azure subscription.</li><li>Captures key identifiers:<ul><li><code>AAD_CLIENT_ID</code>: Application Client ID for authentication.</li><li><code>AAD_TENANT_ID</code>: Azure AD Tenant ID.</li></ul></li></ul><p><strong>3Ô∏è‚É£ Prepare Federated Credential Configuration</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;name&#34;: &#34;${GH_ORG}-${GH_REPO}-federation&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;issuer&#34;: &#34;https://token.actions.githubusercontent.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;subject&#34;: &#34;repo:${GH_ORG}/${GH_REPO}:ref:refs/heads/${GH_BRANCH}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;Federation for GitHub Actions (${GH_ORG}/${GH_REPO})&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;audiences&#34;: [&#34;api://AzureADTokenExchange&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>This JSON configuration defines the federated identity:</p><ul><li><strong>name:</strong> A descriptive identifier for the federated credential.</li><li><strong>issuer:</strong> The trusted issuer of the OIDC token from GitHub Actions.</li><li><strong>subject:</strong> Restricts authentication specifically to your GitHub repository and branch, ensuring tight security boundaries.</li><li><strong>description:</strong> A helpful descriptor for easy management.</li><li><strong>audiences:</strong> The intended Azure token exchange audience.</li></ul><p><strong>4Ô∏è‚É£ Create the Federated Credential</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az ad app federated-credential create --id $AAD_CLIENT_ID --parameters @params.json
</span></span></code></pre></div><ul><li>Links the federated credential configuration with your Azure AD Application.</li><li>Enables GitHub Actions workflows to securely authenticate to Azure via short-lived OIDC tokens, eliminating the need for storing secrets.</li></ul><p><strong>5Ô∏è‚É£ Output GitHub Secrets</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>printf <span style=color:#e6db74>&#34;Add the following secrets to your GitHub repository:\n&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_CLIENT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_CLIENT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_TENANT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_TENANT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_SUBSCRIPTION_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><ul><li>Outputs critical (non-sensitive) identifiers required for configuring GitHub repository secrets.</li><li>These identifiers are safe to store as secrets or variables, as they contain no direct credential secrets (e.g., passwords or tokens).</li></ul><p><strong>‚úÖ Complete script</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Variables</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-subscription-id&gt;&#34;</span>
</span></span><span style=display:flex><span>GH_ORG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-github-org&gt;&#34;</span>
</span></span><span style=display:flex><span>GH_REPO<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-github-repo&gt;&#34;</span>
</span></span><span style=display:flex><span>GH_BRANCH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;main&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Azure AD App Registration with RBAC</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad sp create-for-rbac --role<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Contributor&#34;</span> --scopes<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/subscriptions/</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.appId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenant&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Federated Credential Parameters</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;name&#34;: &#34;${GH_ORG}-${GH_REPO}-federation&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;issuer&#34;: &#34;https://token.actions.githubusercontent.com&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;subject&#34;: &#34;repo:${GH_ORG}/${GH_REPO}:ref:refs/heads/${GH_BRANCH}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;Federation for GitHub Actions (${GH_ORG}/${GH_REPO})&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;audiences&#34;: [&#34;api://AzureADTokenExchange&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Federated Credential</span>
</span></span><span style=display:flex><span>az ad app federated-credential create --id $AAD_CLIENT_ID --parameters @params.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Output required values</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;Add the following secrets to your GitHub repository:\n&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_CLIENT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_CLIENT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_TENANT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_TENANT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_SUBSCRIPTION_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h5 id=github-actions-workflow-app-registration>GitHub Actions Workflow (App Registration)</h5><p>This GitHub Actions workflow demonstrates how to securely authenticate to Azure using an <strong>Azure AD App Registration</strong> with a federated credential, leveraging OpenID Connect (OIDC).</p><p><strong>Pipeline Overview</strong></p><ul><li><p><strong>Workflow Name:</strong><br><code>Azure AD App Federated Credential</code></p></li><li><p><strong>Trigger:</strong><br>Executes on each push to the <code>main</code> branch.</p></li><li><p><strong>Runner:</strong><br>Uses GitHub&rsquo;s hosted Ubuntu runner (<code>ubuntu-latest</code>).</p></li></ul><p><strong>Step 1: Checkout Code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span></code></pre></div><ul><li>Retrieves the latest source code from your repository.</li></ul><p><strong>2Ô∏è‚É£ Authenticate to Azure with OIDC</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/login@v2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>client-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_CLIENT_ID }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tenant-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_TENANT_ID }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>subscription-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_SUBSCRIPTION_ID }}</span>
</span></span></code></pre></div><ul><li>Authenticates the workflow to Azure using OIDC, obtaining an Azure token without ever storing secrets directly in the pipeline.</li><li>Uses the Azure AD App Registration&rsquo;s federated credential configured earlier.</li><li>Essential GitHub secrets (<code>AZURE_CLIENT_ID</code>, <code>AZURE_TENANT_ID</code>, and <code>AZURE_SUBSCRIPTION_ID</code>) were set up previously.</li></ul><p><strong>Security Note:</strong></p><ul><li>The <code>id-token: write</code> permission is crucial, as it enables the workflow to request an OIDC token securely.</li></ul><p><strong>3Ô∏è‚É£ Display Subscription Info</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Display Subscription Info</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/cli@v1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>inlineScript</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      az account show --query &#34;name&#34; -o tsv</span>
</span></span></code></pre></div><ul><li>Runs an Azure CLI command to confirm successful authentication by displaying the active Azure subscription name.</li><li>Demonstrates a basic Azure CLI operation within the authenticated context, indicating readiness for further Azure operations.</li></ul><p><strong>‚úÖ Complete script</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Azure AD App Federated Credential</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>id-token</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>read</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [<span style=color:#ae81ff>main]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/login@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>client-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_CLIENT_ID }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tenant-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_TENANT_ID }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>subscription-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_SUBSCRIPTION_ID }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Display Subscription Info</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/cli@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>inlineScript</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            az account show --query &#34;name&#34; -o tsv</span>
</span></span></code></pre></div><h4 id=github---method-2-azure-managed-identity>GitHub - Method 2: Azure Managed Identity</h4><h5 id=create-managed-identity-with-federated-credential>Create Managed Identity with Federated Credential</h5><p>This script automates the setup of an <strong>Azure Managed Identity</strong> with a federated credential, allowing GitHub Actions workflows to authenticate securely to Azure without storing any secrets.</p><p><strong>Detailed Steps:</strong></p><p><strong>Step 1: Define Variables</strong></p><p>You must customize these variables:</p><ul><li><code>AZURE_SUBSCRIPTION_ID</code>: Your Azure subscription identifier.</li><li><code>AZURE_RG</code>: Name for the Azure resource group to host the managed identity.</li><li><code>AZURE_LOCATION</code>: Azure region to deploy the managed identity (e.g., <code>westeurope</code>).</li><li><code>ID_NAME</code>: Name for the Azure Managed Identity resource.</li><li><code>GH_ORG</code>: GitHub organization or user name.</li><li><code>GH_REPO</code>: GitHub repository name.</li><li><code>GH_BRANCH</code>: Repository branch permitted to authenticate (typically <code>main</code>).</li></ul><p><strong>2Ô∏è‚É£ Create Resource Group</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az group create --resource-group $AZURE_RG --location $AZURE_LOCATION
</span></span></code></pre></div><ul><li>Creates a resource group in Azure, acting as a container for resources such as the managed identity.</li></ul><p><strong>3Ô∏è‚É£ Create Managed Identity</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity create --name $ID_NAME --resource-group $AZURE_RG<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.clientId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_PRINCIPAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.principalId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenantId&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li>Creates a <strong>User-Assigned Managed Identity</strong>, capturing the following identifiers:<ul><li><code>AAD_CLIENT_ID</code>: Application Client ID used for authentication.</li><li><code>AAD_PRINCIPAL_ID</code>: Principal ID used for assigning Azure RBAC roles.</li><li><code>AAD_TENANT_ID</code>: Tenant ID for your Azure Active Directory instance.</li></ul></li></ul><p><strong>4Ô∏è‚É£ Assign RBAC Role to Managed Identity</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az role assignment create --role <span style=color:#e6db74>&#34;Contributor&#34;</span> --assignee-object-id $AAD_PRINCIPAL_ID --scope /subscriptions/$AZURE_SUBSCRIPTION_ID
</span></span></code></pre></div><ul><li>Grants the Managed Identity the <strong>Contributor</strong> role at the subscription level.</li><li>Enables it to perform actions within your Azure subscription securely.</li></ul><p><strong>5Ô∏è‚É£ Create Federated Credential</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az identity federated-credential create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>GH_ORG<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span>GH_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>-federation&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --identity-name $ID_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group $AZURE_RG <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --issuer <span style=color:#e6db74>&#34;https://token.actions.githubusercontent.com&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --subject <span style=color:#e6db74>&#34;repo:</span><span style=color:#e6db74>${</span>GH_ORG<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>GH_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>:ref:refs/heads/</span><span style=color:#e6db74>${</span>GH_BRANCH<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span>
</span></span></code></pre></div><ul><li>Establishes a federated identity between Azure and GitHub Actions using OIDC:<ul><li><code>issuer</code>: GitHub Actions OIDC token issuer URL.</li><li><code>subject</code>: Restricts authentication to your specific GitHub repository and branch.</li><li><code>audiences</code>: Configured audience that Azure expects for authentication via token exchange.</li></ul></li></ul><p>This federated credential allows your GitHub Actions workflow to authenticate with Azure automatically without directly storing sensitive credentials.</p><p><strong>6Ô∏è‚É£ Output Required GitHub Secrets</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>printf <span style=color:#e6db74>&#34;Add the following secrets to your GitHub repository:\n&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_CLIENT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_CLIENT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_TENANT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_TENANT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_SUBSCRIPTION_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><ul><li>Displays critical values that must be added as GitHub repository secrets:<ul><li><code>AZURE_CLIENT_ID</code></li><li><code>AZURE_TENANT_ID</code></li><li><code>AZURE_SUBSCRIPTION_ID</code></li></ul></li></ul><p>These variables do not store sensitive passwords or secrets directly‚Äîonly identifiers necessary for the authentication process.</p><p><strong>‚úÖ Complete script</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Variables</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-subscription-id&gt;&#34;</span>
</span></span><span style=display:flex><span>AZURE_RG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rg-gh-oidc&#34;</span>
</span></span><span style=display:flex><span>AZURE_LOCATION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;westeurope&#34;</span>
</span></span><span style=display:flex><span>ID_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;id-gh-oidc&#34;</span>
</span></span><span style=display:flex><span>GH_ORG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-github-org&gt;&#34;</span>
</span></span><span style=display:flex><span>GH_REPO<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;your-github-repo&gt;&#34;</span>
</span></span><span style=display:flex><span>GH_BRANCH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;main&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Resource Group</span>
</span></span><span style=display:flex><span>az group create --resource-group $AZURE_RG --location $AZURE_LOCATION
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Managed Identity</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity create --name $ID_NAME --resource-group $AZURE_RG<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.clientId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_PRINCIPAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.principalId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenantId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Assign RBAC role to Managed Identity</span>
</span></span><span style=display:flex><span>az role assignment create --role <span style=color:#e6db74>&#34;Contributor&#34;</span> --assignee-object-id $AAD_PRINCIPAL_ID --scope /subscriptions/$AZURE_SUBSCRIPTION_ID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Federated Credential</span>
</span></span><span style=display:flex><span>az identity federated-credential create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>GH_ORG<span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span>GH_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>-federation&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --identity-name $ID_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --resource-group $AZURE_RG <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --issuer <span style=color:#e6db74>&#34;https://token.actions.githubusercontent.com&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --subject <span style=color:#e6db74>&#34;repo:</span><span style=color:#e6db74>${</span>GH_ORG<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>GH_REPO<span style=color:#e6db74>}</span><span style=color:#e6db74>:ref:refs/heads/</span><span style=color:#e6db74>${</span>GH_BRANCH<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Output required values</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;Add the following secrets to your GitHub repository:\n&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_CLIENT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_CLIENT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_TENANT_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AAD_TENANT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>printf <span style=color:#e6db74>&#34;AZURE_SUBSCRIPTION_ID=%s\n&#34;</span> <span style=color:#e6db74>&#34;</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h5 id=github-actions-workflow-managed-identity>GitHub Actions Workflow (Managed Identity)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Azure Managed Identity Federated Credential</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>id-token</span>: <span style=color:#ae81ff>write</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>read</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [<span style=color:#ae81ff>main]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/login@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>client-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_CLIENT_ID }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tenant-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_TENANT_ID }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>subscription-id</span>: <span style=color:#ae81ff>${{ secrets.AZURE_SUBSCRIPTION_ID }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Display Subscription Info</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>azure/cli@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>inlineScript</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            az account show --query &#34;name&#34; -o tsv</span>
</span></span></code></pre></div><hr><h3 id=azure-devops-pipelines-integration>Azure DevOps Pipelines Integration</h3><p>Federated identity integration with Azure DevOps pipelines allows secure, secretless authentication to Azure resources using Azure AD&rsquo;s built-in OIDC support. This prevents credential leaks and reduces the spread of secrets across your DevOps pipelines.</p><p>Below are clear guidelines to integrate federated credentials using either an <strong>Azure AD App Registration</strong> or an <strong>Azure Managed Identity</strong>. Each method includes complete scripts and Azure DevOps pipelines.</p><h4 id=azure-devops---method-1-azure-ad-app-registration>Azure DevOps - Method 1: Azure AD App Registration</h4><h5 id=azure-devops---create-azure-ad-application-with-federated-credential>Azure DevOps - Create Azure AD Application with Federated Credential</h5><p>This script automates the creation and configuration of an <strong>Azure DevOps Service Connection</strong> using OpenID Connect (OIDC) federation with an <strong>Azure AD App Registration</strong>. This enables Azure DevOps Pipelines to authenticate securely to Azure without storing secrets in the pipeline.</p><p><strong>Detailed Steps:</strong></p><p><strong>1. Variables Initialization</strong></p><p>You must customize these variables according to your environment:</p><ul><li><code>AZURE_SUBSCRIPTION_ID</code>: Your Azure subscription ID.</li><li><code>AZDO_ORGANIZATION_NAME</code>: Azure DevOps organization name (e.g., <code>myorg</code>).</li><li><code>AZDO_PROJECT_NAME</code>: Azure DevOps project name.</li><li><code>AZDO_SERVICE_ENDPOINT_NAME</code>: Name for the Azure DevOps Service Connection.</li></ul><hr><p><strong>2. Azure Subscription Name Retrieval</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az account show -s $AZURE_SUBSCRIPTION_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_NAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.name&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li>Fetches the Azure subscription details.</li><li>Captures the subscription name to be used in subsequent configurations.</li></ul><p><strong>3. Azure DevOps CLI Configuration</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>AZDO_BASE_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://dev.azure.com/</span>$AZDO_ORGANIZATION_NAME<span style=color:#e6db74>&#34;</span>  
</span></span><span style=display:flex><span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL
</span></span></code></pre></div><ul><li>Sets the Azure DevOps CLI default organization context for subsequent commands.</li></ul><p><strong>4. Azure DevOps Project Creation</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops project list | jq -e --arg PROJECT_NAME <span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $PROJECT_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  az devops project create --name $AZDO_PROJECT_NAME --description $AZDO_PROJECT_NAME --visibility private
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Checks if the Azure DevOps project already exists.</li><li>Creates the project if it doesn&rsquo;t exist (with private visibility).</li></ul><p><strong>5. Azure AD Application (Service Principal) Creation</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad sp create-for-rbac --role<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Contributor&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --scopes<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/subscriptions/</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>   --name app-$AZDO_ORGANIZATION_NAME-azdo-oidc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.appId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenant&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li>Creates an Azure AD <strong>Service Principal</strong> with the Contributor role scoped to your Azure subscription.</li><li>Captures necessary identifiers (<code>AAD_CLIENT_ID</code> and <code>AAD_TENANT_ID</code>) for authentication.</li></ul><p><strong>6. Azure DevOps Service Endpoint Configuration</strong></p><p>The script creates a JSON file (<code>params.azdo.json</code>) that defines an Azure RM (Resource Manager) service endpoint with federated authentication parameters:</p><ul><li><code>authorization.scheme</code>: Set as <code>WorkloadIdentityFederation</code> to use OIDC.</li><li>Provides details like subscription ID, subscription name, tenant ID, and service principal client ID.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;data&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;subscriptionId&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;subscriptionName&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;authorization&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;parameters&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;serviceprincipalid&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;tenantid&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;scheme&#34;</span>: <span style=color:#e6db74>&#34;WorkloadIdentityFederation&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>7. Azure DevOps Service Endpoint Creation or Retrieval</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -e --arg SE_NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $SE_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --service-endpoint-configuration params.azdo.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --organization $AZDO_BASE_URL <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --project $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --detect true<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                                                                                                                                 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>  
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint list <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME | jq -r <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --arg NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name==$NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint show <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --project $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --id $SERVICE_ENDPOINT_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Checks if the Service Endpoint already exists in the project.</li><li>Creates the endpoint if it doesn‚Äôt exist, or retrieves existing endpoint details.</li><li>Captures key identifiers like <code>SERVICE_ENDPOINT_ID</code>.</li></ul><p><strong>8. Retrieve Issuer and Subject from Service Endpoint</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SERVICE_ENDPOINT_ISSUER<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationIssuer&#39;</span><span style=color:#66d9ef>)</span>                                                                      
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_SUBJECT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationSubject&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li>Retrieves the <strong>Issuer URL</strong> and <strong>Subject claim</strong> from the Service Endpoint configuration, needed for Azure AD federated credential setup.</li></ul><p><strong>9. Federated Credential Creation or Update</strong></p><p>The script prepares two JSON configuration files for Azure AD federated credential:</p><ul><li><strong>params.create.json</strong> (used for initial creation)</li><li><strong>params.update.json</strong> (used for subsequent updates)</li></ul><p>Both files specify the following properties:</p><ul><li><code>name</code>: Credential identifier.</li><li><code>issuer</code>: Token issuer URL from Azure DevOps.</li><li><code>subject</code>: Subject claim that uniquely identifies the Azure DevOps Service Endpoint.</li><li><code>audiences</code>: Specifies <code>"api://AzureADTokenExchange"</code> as the audience for OIDC.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;issuer&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;subject&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;audiences&#34;</span>: [<span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then it checks whether the federated credential already exists:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az ad app federated-credential list --id $AAD_CLIENT_ID | jq -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  az ad app federated-credential create --id $AAD_CLIENT_ID --parameters params.create.json
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  FEDERATED_CREDENTIAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad app federated-credential list --id $AAD_CLIENT_ID | jq -r -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  az ad app federated-credential update --id $AAD_CLIENT_ID --federated-credential-id $FEDERATED_CREDENTIAL_ID --parameters params.update.json
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Creates a new federated credential linking Azure DevOps and Azure AD, or updates the existing one if needed.</li></ul><p><strong>‚úÖ Complete script</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Variables</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure Subscription Id</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Organization Name</span>
</span></span><span style=display:flex><span>AZDO_ORGANIZATION_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;myorg&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Project Name</span>
</span></span><span style=display:flex><span>AZDO_PROJECT_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;myproject&gt;&#34;</span>                                  
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Service Account Name</span>
</span></span><span style=display:flex><span>AZDO_SERVICE_ENDPOINT_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;mysvcconnection&gt;&#34;</span>                      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure Subscription Name</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az account show -s $AZURE_SUBSCRIPTION_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_NAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.name&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps base URL</span>
</span></span><span style=display:flex><span>AZDO_BASE_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://dev.azure.com/</span>$AZDO_ORGANIZATION_NAME<span style=color:#e6db74>&#34;</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set Azure DevOps defaults</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create DevOps Project</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops project list | jq -e --arg PROJECT_NAME <span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $PROJECT_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops project create --name $AZDO_PROJECT_NAME --description $AZDO_PROJECT_NAME --visibility private<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create App Registration</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad sp create-for-rbac --role<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Contributor&#34;</span> --scopes<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/subscriptions/</span>$AZURE_SUBSCRIPTION_ID<span style=color:#e6db74>&#34;</span> --name app-$AZDO_ORGANIZATION_NAME-azdo-oidc<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get AAD Application Id</span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.appId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenant&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Service Endpoint Configuration params file params.azdo.json</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.azdo.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;data&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;subscriptionId&#34;: &#34;${AZURE_SUBSCRIPTION_ID}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;subscriptionName&#34;: &#34;$AZURE_SUBSCRIPTION_NAME&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;authorization&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;parameters&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;serviceprincipalid&#34;: &#34;${AAD_CLIENT_ID}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;tenantid&#34;: &#34;${AAD_TENANT_ID}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;scheme&#34;: &#34;WorkloadIdentityFederation&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;name&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;serviceEndpointProjectReferences&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;description&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;name&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;projectReference&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;name&#34;: &#34;${AZDO_PROJECT_NAME}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;type&#34;: &#34;azurerm&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;url&#34;: &#34;https://management.azure.com/&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Or Get Service Endpoint</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -e --arg SE_NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $SE_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint create --service-endpoint-configuration params.azdo.json --organization $AZDO_BASE_URL --project $AZDO_PROJECT_NAME --detect true<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Service Endpoint Id</span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                                                                                                                                 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Service Endpoint Id</span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -r --arg NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name==$NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint show --project $AZDO_PROJECT_NAME --id $SERVICE_ENDPOINT_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Service Endpoint Issuer</span>
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_ISSUER<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationIssuer&#39;</span><span style=color:#66d9ef>)</span>                                                                      
</span></span><span style=display:flex><span><span style=color:#75715e># Service Endpoint Subject</span>
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_SUBJECT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationSubject&#39;</span><span style=color:#66d9ef>)</span>                                                                    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Federated Credential Configuration params file params.json</span>
</span></span><span style=display:flex><span>PARAMS_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>-federated-identity&#34;</span>
</span></span><span style=display:flex><span>PARAMS_ISSUER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SERVICE_ENDPOINT_ISSUER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>PARAMS_SUBJECT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SERVICE_ENDPOINT_SUBJECT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>PARAMS_DESCRIPTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Federation for Service Connection </span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74> in </span>$AZDO_BASE_URL<span style=color:#e6db74>/</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>/_settings/adminservices?resourceId=</span>$SERVICE_ENDPOINT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.create.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;name&#34;: &#34;${PARAMS_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;issuer&#34;: &#34;${SERVICE_ENDPOINT_ISSUER}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;subject&#34;: &#34;${PARAMS_SUBJECT}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;${PARAMS_DESCRIPTION}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;audiences&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;api://AzureADTokenExchange&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.update.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;issuer&#34;: &#34;${SERVICE_ENDPOINT_ISSUER}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;subject&#34;: &#34;${PARAMS_SUBJECT}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;${PARAMS_DESCRIPTION}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;audiences&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;api://AzureADTokenExchange&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Or Update Federated Credential</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az ad app federated-credential list --id $AAD_CLIENT_ID | jq -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad app federated-credential create --id $AAD_CLIENT_ID --parameters params.create.json<span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  FEDERATED_CREDENTIAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad app federated-credential list --id $AAD_CLIENT_ID | jq -r -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az ad app federated-credential update --id $AAD_CLIENT_ID --federated-credential-id $FEDERATED_CREDENTIAL_ID --parameters params.update.json<span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><h5 id=azure-devops---yaml-pipeline-app-registration>Azure DevOps - YAML Pipeline (App Registration)</h5><p>This script automates the following tasks:</p><ul><li>Cloning an Azure DevOps Git repository.</li><li>Adding a pipeline YAML definition.</li><li>Committing and pushing pipeline changes.</li><li>Creating a pipeline in Azure DevOps that leverages a federated identity service connection.</li></ul><p><strong>Detailed Steps:</strong></p><p><strong>1. Clone Azure DevOps Repository</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://$AZDO_ORGANIZATION_NAME@dev.azure.com/$AZDO_ORGANIZATION_NAME/$AZDO_PROJECT_NAME/_git/$AZDO_PROJECT_NAME
</span></span><span style=display:flex><span>cd $AZDO_PROJECT_NAME
</span></span></code></pre></div><ul><li>Clones your Azure DevOps repository locally using HTTPS authentication.</li><li>Navigates into the cloned repository folder.</li></ul><p><strong>2. Set Variables for Pipeline</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PIPELINE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pipelines&#34;</span>
</span></span><span style=display:flex><span>IDENTITY_TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sp&#34;</span>
</span></span></code></pre></div><ul><li><code>PIPELINE_DIR</code>: Directory to store pipeline YAML files.</li><li><code>IDENTITY_TYPE</code>: Identifier (e.g., &ldquo;sp&rdquo; for service principal) used to name the pipeline YAML file clearly.</li></ul><p><strong>3. Create Pipeline Directory</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$PIPELINE_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    mkdir $PIPELINE_DIR
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Checks if the directory for pipelines exists, creating it if necessary.</li></ul><p><strong>4. Generate Azure DevOps Pipeline YAML</strong></p><p>Creates a pipeline YAML file at <code>pipelines/sp.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>pool</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>vmImage</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>task</span>: <span style=color:#ae81ff>AzureCLI@2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>azureSubscription</span>: <span style=color:#e6db74>&#39;${AZDO_SERVICE_ENDPOINT_NAME}&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scriptType</span>: <span style=color:#e6db74>&#39;pscore&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scriptLocation</span>: <span style=color:#e6db74>&#39;inlineScript&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inlineScript</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      az account show --query id -o tsv</span>
</span></span></code></pre></div><ul><li><strong>Trigger</strong>: Runs on every commit to the <code>main</code> branch.</li><li><strong>Agent pool</strong>: Uses a hosted Ubuntu image (<code>ubuntu-latest</code>).</li><li><strong>Task</strong>: Executes an Azure CLI command:<ul><li>Uses the Azure service connection (<code>AZDO_SERVICE_ENDPOINT_NAME</code>) with federated identity.</li><li>Displays the Azure subscription ID to verify connectivity.</li></ul></li></ul><p><strong>5. Commit and Push Pipeline YAML</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global user.name $GIT_USER
</span></span><span style=display:flex><span>git config --global user.email $GIT_EMAIL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! git diff --quiet HEAD -- <span style=color:#e6db74>&#34;./</span>$PIPELINE_DIR<span style=color:#e6db74>/</span>$IDENTITY_TYPE<span style=color:#e6db74>.yaml&#34;</span> ; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  git add ./$PIPELINE_DIR/$IDENTITY_TYPE.yaml
</span></span><span style=display:flex><span>  git commit -m <span style=color:#e6db74>&#34;üìä Add or Update pipeline.&#34;</span>
</span></span><span style=display:flex><span>  git push origin main
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Nothing to commit.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Sets Git global user configuration (required for commits).</li><li>Checks if the pipeline YAML file has changed:<ul><li>If changed, commits and pushes updates.</li><li>If unchanged, skips the commit.</li></ul></li></ul><p><strong>6. Configure Azure DevOps CLI and Create Pipeline</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az pipelines create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name <span style=color:#e6db74>&#34;</span>$IDENTITY_TYPE<span style=color:#e6db74>-pipeline&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;This is a sample pipeline to use federated identity&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository-type tfsgit <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --branch main <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --yaml-path $PIPELINE_DIR/$IDENTITY_TYPE.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME
</span></span></code></pre></div><ul><li>Configures Azure DevOps CLI defaults for subsequent commands.</li><li>Creates the Azure DevOps pipeline with the specified configuration:<ul><li><code>name</code>: Pipeline name (<code>sp-pipeline</code>).</li><li><code>description</code>: Human-readable pipeline description.</li><li><code>repository</code>: The Azure DevOps Git repository hosting the pipeline YAML.</li><li><code>branch</code>: Branch to monitor (<code>main</code>).</li><li><code>yaml-path</code>: Path to the pipeline YAML file.</li><li><code>project</code>: Azure DevOps project name.</li></ul></li></ul><p><strong>‚úÖ Complete scripts</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://$AZDO_ORGANIZATION_NAME@dev.azure.com/$AZDO_ORGANIZATION_NAME/$AZDO_PROJECT_NAME/_git/$AZDO_PROJECT_NAME
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd $AZDO_PROJECT_NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PIPELINE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pipelines&#34;</span>
</span></span><span style=display:flex><span>IDENTITY_TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create directory if not exists</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$PIPELINE_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    mkdir $PIPELINE_DIR
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Store pipeline</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; $PIPELINE_DIR/$IDENTITY_TYPE.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>trigger:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pool:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  vmImage: ubuntu-latest
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>steps:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- task: AzureCLI@2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    azureSubscription: &#39;${AZDO_SERVICE_ENDPOINT_NAME}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scriptType: &#39;pscore&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scriptLocation: &#39;inlineScript&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    inlineScript: |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      az account show --query id -o tsv
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Commit pipeline</span>
</span></span><span style=display:flex><span>git config --global user.name $GIT_USER
</span></span><span style=display:flex><span>git config --global user.email $GIT_EMAIL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! git diff --quiet HEAD -- <span style=color:#e6db74>&#34;./</span>$PIPELINE_DIR<span style=color:#e6db74>/</span>$IDENTITY_TYPE<span style=color:#e6db74>.yaml&#34;</span> ; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  git add ./$PIPELINE_DIR/$IDENTITY_TYPE.yaml
</span></span><span style=display:flex><span>  git commit -m <span style=color:#e6db74>&#34;üìä Add or Update pipeline.&#34;</span>
</span></span><span style=display:flex><span>  git push origin main
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Nothing to commit.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az pipelines create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name <span style=color:#e6db74>&#34;</span>$IDENTITY_TYPE<span style=color:#e6db74>-pipeline&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;This is a sample pipeline to use federated identity&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository-type tfsgit <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --branch main <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --yaml-path $PIPELINE_DIR/$IDENTITY_TYPE.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> Ensure the pipeline has the setting <strong>&ldquo;Allow scripts to access the OAuth token&rdquo;</strong> enabled (<code>System.AccessToken</code>) under pipeline options.</p></blockquote><hr><h4 id=azure-devops---method-2-azure-managed-identity>Azure DevOps - Method 2: Azure Managed Identity</h4><h5 id=azure-devops---create-managed-identity-with-federated-credential>Azure DevOps - Create Managed Identity with Federated Credential</h5><p>This script sets up an end-to-end secure integration between <strong>Azure DevOps pipelines</strong> and <strong>Azure</strong> using <strong>User-Assigned Managed Identity</strong> combined with <strong>Federated Identity (OIDC)</strong>. This allows Azure DevOps pipelines to securely authenticate to Azure without storing secrets directly.</p><p><strong>Detailed Steps:</strong></p><p><strong>Step 1: Define Variables</strong></p><p>Variables you customize at the top of the script:</p><ul><li><p><strong>Azure Subscription Info:</strong></p><ul><li><code>AZURE_SUBSCRIPTION_ID</code>: ID of your Azure subscription.</li><li><code>AZURE_LOCATION</code>: Azure region (e.g., <code>westeurope</code>).</li></ul></li><li><p><strong>Azure DevOps Info:</strong></p><ul><li><code>AZDO_ORGANIZATION_NAME</code>: Your Azure DevOps organization name.</li><li><code>AZDO_PROJECT_NAME</code>: Your Azure DevOps project name.</li><li><code>AZDO_SERVICE_ENDPOINT_NAME</code>: Name of the Azure DevOps Service Connection.</li></ul></li><li><p><strong>Git Config (used later for pipeline commits):</strong></p><ul><li><code>GIT_USER</code>: Your Git username.</li><li><code>GIT_EMAIL</code>: Your Git email.</li></ul></li></ul><p><strong>2Ô∏è‚É£ Azure Resource Group and Managed Identity Creation</strong></p><p>The script creates a resource group and managed identity for authentication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az group create --location $AZURE_LOCATION --name $AZURE_RG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity create --name $ID_NAME --resource-group $AZURE_RG<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MI_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                       
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.clientId&#39;</span><span style=color:#66d9ef>)</span>         
</span></span><span style=display:flex><span>AAD_PRINICIPAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.principalId&#39;</span><span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenantId&#39;</span><span style=color:#66d9ef>)</span>         
</span></span></code></pre></div><ul><li>A <strong>Resource Group</strong> is created to host the Managed Identity.</li><li>A <strong>User-Assigned Managed Identity</strong> is created:<ul><li><code>AAD_CLIENT_ID</code>: Used to authenticate from Azure DevOps.</li><li><code>AAD_PRINICIPAL_ID</code>: Needed for Azure RBAC assignments.</li><li><code>AAD_TENANT_ID</code>: Azure AD Tenant identifier.</li></ul></li></ul><p><strong>3Ô∏è‚É£ Assign RBAC Role to Managed Identity</strong></p><p>Assign the Managed Identity the <code>Contributor</code> role on the specified Azure subscription:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az role assignment create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --role <span style=color:#e6db74>&#34;Contributor&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --assignee-object-id $AAD_PRINICIPAL_ID <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --assignee-principal-type ServicePrincipal <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --scope /subscriptions/$AZURE_SUBSCRIPTION_ID
</span></span></code></pre></div><p>This grants the Managed Identity permissions to perform Azure operations in your subscription.</p><p><strong>4Ô∏è‚É£ Azure DevOps Configuration</strong></p><p>Set Azure DevOps CLI defaults and ensure the project exists:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops project list | jq -e --arg PROJECT_NAME <span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.value[] | select(.name == $PROJECT_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  az devops project create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --visibility private
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Configures Azure DevOps CLI context.</li><li>Creates the Azure DevOps project if it doesn‚Äôt already exist.</li></ul><p><strong>5Ô∏è‚É£ Create Azure DevOps Service Endpoint with Federated Identity</strong></p><p>A service endpoint configuration (<code>params.azdo.json</code>) is created using Managed Identity and OIDC federation:</p><ul><li>Authentication uses the scheme: <code>"WorkloadIdentityFederation"</code>.</li><li>References the Managed Identity‚Äôs <code>clientId</code> and <code>tenantId</code>.</li></ul><p>The script checks if the Service Endpoint exists, creates it if not:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -e --arg SE_NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $SE_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --service-endpoint-configuration params.azdo.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --organization $AZDO_BASE_URL <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --detect true<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                                                                                                                                 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>  
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint list <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME | jq -r <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --arg NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name==$NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint show <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --id $SERVICE_ENDPOINT_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p><strong>6Ô∏è‚É£ Extracting Federated Credential Information</strong></p><p>From the Service Endpoint, it retrieves critical parameters needed for OIDC federation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SERVICE_ENDPOINT_ISSUER<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationIssuer&#39;</span><span style=color:#66d9ef>)</span>                                                                      
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_SUBJECT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationSubject&#39;</span><span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ul><li><strong>Issuer</strong>: The trusted OIDC token issuer URL from Azure DevOps.</li><li><strong>Subject</strong>: Unique identifier scoped specifically to your Azure DevOps service endpoint.</li></ul><p>7Ô∏è‚É£ Create or Update Azure Managed Identity Federated Credential**</p><p>Using the issuer and subject obtained above, the script creates or updates the federated credential for the Managed Identity:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az identity federated-credential list --identity-name $ID_NAME --resource-group $AZURE_RG | jq -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  az identity federated-credential create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --identity-name $ID_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name $PARAMS_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --resource-group $AZURE_RG <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --issuer $SERVICE_ENDPOINT_ISSUER <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --subject $SERVICE_ENDPOINT_SUBJECT
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  az identity federated-credential update <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --identity-name $ID_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name $PARAMS_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --resource-group $AZURE_RG <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --issuer $SERVICE_ENDPOINT_ISSUER <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --subject $SERVICE_ENDPOINT_SUBJECT
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><ul><li>Links the Managed Identity securely with Azure DevOps using OIDC federation.</li><li>Ensures Azure DevOps Pipelines can authenticate securely without stored credentials.</li></ul><p><strong>‚úÖ Complete script</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Variables</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>GIT_USER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Sujith Quintelier&#34;</span>
</span></span><span style=display:flex><span>GIT_EMAIL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;squintelier@company.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure Subscription Id</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#75715e># Azure location</span>
</span></span><span style=display:flex><span>AZURE_LOCATION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;westeurope&#34;</span>                                   
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Project Name</span>
</span></span><span style=display:flex><span>AZDO_PROJECT_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;myproject&gt;&#34;</span>                                  
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Organization Name</span>
</span></span><span style=display:flex><span>AZDO_ORGANIZATION_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;myorg&gt;&#34;</span>                           
</span></span><span style=display:flex><span><span style=color:#75715e># Azure DevOps Service Account Name</span>
</span></span><span style=display:flex><span>AZDO_SERVICE_ENDPOINT_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;mysvcconnection&gt;&#34;</span>                      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure Resource Group</span>
</span></span><span style=display:flex><span>AZURE_RG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rg-</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span>                                         
</span></span><span style=display:flex><span><span style=color:#75715e># Managed Identity Name</span>
</span></span><span style=display:flex><span>ID_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;id-</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span>                                          
</span></span><span style=display:flex><span><span style=color:#75715e># squintelier|xpirit</span>
</span></span><span style=display:flex><span>AZDO_BASE_URL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://dev.azure.com/</span>$AZDO_ORGANIZATION_NAME<span style=color:#e6db74>&#34;</span>  <span style=color:#75715e># Azure DevOps base URL</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Azure Subscription Name</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az account show -s $AZURE_SUBSCRIPTION_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>AZURE_SUBSCRIPTION_NAME<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.name&#39;</span><span style=color:#66d9ef>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set Azure DevOps defaults</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create DevOps Project</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops project list | jq -e --arg PROJECT_NAME <span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.value[] | select(.name == $PROJECT_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops project create --name $AZDO_PROJECT_NAME --description $AZDO_PROJECT_NAME --visibility private<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Resource Group</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az group create --location $AZURE_LOCATION --name $AZURE_RG<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Managed Identity</span>
</span></span><span style=display:flex><span>result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity create --name $ID_NAME --resource-group $AZURE_RG<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Managed Identity Id</span>
</span></span><span style=display:flex><span>MI_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                       
</span></span><span style=display:flex><span><span style=color:#75715e># AAD Application Id</span>
</span></span><span style=display:flex><span>AAD_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.clientId&#39;</span><span style=color:#66d9ef>)</span>         
</span></span><span style=display:flex><span><span style=color:#75715e># AAD Principal Id</span>
</span></span><span style=display:flex><span>AAD_PRINICIPAL_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.principalId&#39;</span><span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span><span style=color:#75715e># AAD Tenant Id</span>
</span></span><span style=display:flex><span>AAD_TENANT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.tenantId&#39;</span><span style=color:#66d9ef>)</span>         
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Role Assignment</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># With Graph Permissions (uncomment below)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># az role assignment create --role &#34;Contributor&#34; --assignee $MI_ID --scope /subscriptions/$AZURE_SUBSCRIPTION_ID</span>
</span></span><span style=display:flex><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Without Graph Permissions (uncomment below)</span>
</span></span><span style=display:flex><span>az role assignment create --role <span style=color:#e6db74>&#34;Contributor&#34;</span> --assignee-object-id $AAD_PRINICIPAL_ID --assignee-principal-type ServicePrincipal --scope /subscriptions/$AZURE_SUBSCRIPTION_ID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Service Endpoint Configuration params file params.azdo.json</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; params.azdo.json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;data&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;subscriptionId&#34;: &#34;${AZURE_SUBSCRIPTION_ID}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;subscriptionName&#34;: &#34;$AZURE_SUBSCRIPTION_NAME&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;authorization&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;parameters&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;serviceprincipalid&#34;: &#34;${AAD_CLIENT_ID}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;tenantid&#34;: &#34;${AAD_TENANT_ID}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;scheme&#34;: &#34;WorkloadIdentityFederation&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;description&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;name&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;serviceEndpointProjectReferences&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;description&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;name&#34;: &#34;${AZDO_SERVICE_ENDPOINT_NAME}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;projectReference&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;name&#34;: &#34;${AZDO_PROJECT_NAME}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;type&#34;: &#34;azurerm&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;url&#34;: &#34;https://management.azure.com/&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Or Get Service Endpoint</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -e --arg SE_NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $SE_NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint create --service-endpoint-configuration params.azdo.json --organization $AZDO_BASE_URL --project $AZDO_PROJECT_NAME --detect true<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Service Endpoint Id</span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.id&#39;</span><span style=color:#66d9ef>)</span>                                                                                                                                 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># Service Endpoint Id</span>
</span></span><span style=display:flex><span>  SERVICE_ENDPOINT_ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint list --project $AZDO_PROJECT_NAME | jq -r --arg NAME <span style=color:#e6db74>&#34;</span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name==$NAME) | .id&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az devops service-endpoint show --project $AZDO_PROJECT_NAME --id $SERVICE_ENDPOINT_ID<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Service Endpoint Issuer</span>
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_ISSUER<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationIssuer&#39;</span><span style=color:#66d9ef>)</span>                                                                      
</span></span><span style=display:flex><span><span style=color:#75715e># Service Endpoint Subject</span>
</span></span><span style=display:flex><span>SERVICE_ENDPOINT_SUBJECT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $result | jq -r <span style=color:#e6db74>&#39;.authorization.parameters.workloadIdentityFederationSubject&#39;</span><span style=color:#66d9ef>)</span>                                                                    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Federated Credential Configuration params file params.json</span>
</span></span><span style=display:flex><span>PARAMS_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>-federated-identity&#34;</span>
</span></span><span style=display:flex><span>PARAMS_ISSUER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SERVICE_ENDPOINT_ISSUER<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>PARAMS_SUBJECT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>SERVICE_ENDPOINT_SUBJECT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>PARAMS_DESCRIPTION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Federation for Service Connection </span>$AZDO_SERVICE_ENDPOINT_NAME<span style=color:#e6db74> in </span>$AZDO_BASE_URL<span style=color:#e6db74>/</span>$AZDO_PROJECT_NAME<span style=color:#e6db74>/_settings/adminservices?resourceId=</span>$SERVICE_ENDPOINT_ID<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create Or Update Federated Credential</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! az identity federated-credential list --identity-name $ID_NAME --resource-group $AZURE_RG | jq -e --arg NAME <span style=color:#e6db74>&#34;</span>$PARAMS_NAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#39;.[] | select(.name == $NAME)&#39;</span> &gt; /dev/null; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity federated-credential create --identity-name $ID_NAME --name $PARAMS_NAME  --resource-group $AZURE_RG --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span> --issuer $SERVICE_ENDPOINT_ISSUER --subject $PARAMS_SUBJECT<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>az identity federated-credential update --identity-name $ID_NAME --name $PARAMS_NAME  --resource-group $AZURE_RG --audiences <span style=color:#e6db74>&#34;api://AzureADTokenExchange&#34;</span> --issuer $SERVICE_ENDPOINT_ISSUER --subject $PARAMS_SUBJECT<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><h5 id=azure-devops-yaml-pipeline-managed-identity>Azure DevOps YAML Pipeline (Managed Identity)</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>git clone https://$AZDO_ORGANIZATION_NAME@dev.azure.com/$AZDO_ORGANIZATION_NAME/$AZDO_PROJECT_NAME/_git/$AZDO_PROJECT_NAME
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd $AZDO_PROJECT_NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PIPELINE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pipelines&#34;</span>
</span></span><span style=display:flex><span>IDENTITY_TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;mi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create directory if not exists</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$PIPELINE_DIR<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    mkdir $PIPELINE_DIR
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Store pipeline</span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; $PIPELINE_DIR/$IDENTITY_TYPE.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>trigger:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pool:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  vmImage: ubuntu-latest
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>steps:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- task: AzureCLI@2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    azureSubscription: &#39;${AZDO_SERVICE_ENDPOINT_NAME}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scriptType: &#39;pscore&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    scriptLocation: &#39;inlineScript&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    inlineScript: |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      az account show --query id -o tsv
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Commit pipeline</span>
</span></span><span style=display:flex><span>git config --global user.name $GIT_USER
</span></span><span style=display:flex><span>git config --global user.email $GIT_EMAIL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! git diff --quiet HEAD -- <span style=color:#e6db74>&#34;./</span>$PIPELINE_DIR<span style=color:#e6db74>/</span>$IDENTITY_TYPE<span style=color:#e6db74>.yaml&#34;</span> ; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  git add ./$PIPELINE_DIR/$IDENTITY_TYPE.yaml
</span></span><span style=display:flex><span>  git commit -m <span style=color:#e6db74>&#34;üìä Add or Update pipeline.&#34;</span>
</span></span><span style=display:flex><span>  git push origin main
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Nothing to commit.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az devops configure --defaults organization<span style=color:#f92672>=</span>$AZDO_BASE_URL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az pipelines create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name <span style=color:#e6db74>&#34;</span>$IDENTITY_TYPE<span style=color:#e6db74>-pipeline&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;This is a sample pipeline to use federated identity&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository $AZDO_PROJECT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repository-type tfsgit <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --branch main <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --yaml-path $PIPELINE_DIR/$IDENTITY_TYPE.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --project $AZDO_PROJECT_NAME
</span></span></code></pre></div><blockquote><p><strong>Important:</strong></p><ul><li>Ensure <strong>&ldquo;Allow scripts to access the OAuth token&rdquo;</strong> is enabled to access the federated token in pipeline tasks.</li><li><code>$(System.AccessToken)</code> provides the pipeline identity token securely without storing any secrets.</li></ul></blockquote><hr><h2 id=best-practices>Best Practices</h2><ul><li><strong>Use Azure AD Federated Credentials:</strong> Configure pipelines to authenticate via Azure AD federated credentials rather than storing secrets directly.</li><li><strong>Enforce Least Privilege:</strong> Assign minimal necessary permissions to identities used by pipelines.</li><li><strong>Regular Audits:</strong> Frequently audit access logs and credential configurations to ensure ongoing security.</li></ul><hr><h2 id=conclusion>Conclusion</h2><p>Implementing federated identity within your CI/CD pipelines enhances security, reduces complexity, and prevents secret sprawl. Leveraging Azure AD integration with GitHub Actions and Azure DevOps pipelines provides a robust, scalable, and secure approach to managing authentication without compromising operational efficiency.</p></div><div class="d-flex align-items-center flex-wrap"><span class=mx-1><i class="fas fa-folder"></i></span>
<a href=https://quintelier.dev/categories/devops/><span class="badge rounded-pill bg-secondary mx-1">DevOps</span></a>
<a href=https://quintelier.dev/categories/security/><span class="badge rounded-pill bg-secondary mx-1">Security</span></a>
<a href=https://quintelier.dev/categories/azure/><span class="badge rounded-pill bg-secondary mx-1">Azure</span></a></div><div class="d-flex align-items-center flex-wrap"><span class=mx-1><i class="fas fa-tags"></i></span>
<a href=https://quintelier.dev/tags/azure/><span class="badge rounded-pill bg-success mx-1">Azure</span></a>
<a href=https://quintelier.dev/tags/github-actions/><span class="badge rounded-pill bg-success mx-1">GitHub Actions</span></a>
<a href=https://quintelier.dev/tags/azure-devops/><span class="badge rounded-pill bg-success mx-1">Azure DevOps</span></a>
<a href=https://quintelier.dev/tags/federated-identity/><span class="badge rounded-pill bg-success mx-1">Federated Identity</span></a>
<a href=https://quintelier.dev/tags/security/><span class="badge rounded-pill bg-success mx-1">Security</span></a>
<a href=https://quintelier.dev/tags/ci-cd/><span class="badge rounded-pill bg-success mx-1">CI-CD</span></a>
<a href=https://quintelier.dev/tags/authentication/><span class="badge rounded-pill bg-success mx-1">Authentication</span></a></div><div class="col-lg-6 mt-3 mb-3 mx-auto text-center"><script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=sujithq data-color=#6a1c56 data-emoji data-font=Cookie data-text="Enjoyed it? Fuel my coffee" data-outline-color=#ffffff data-font-color=#ffffff data-coffee-color=#FFDD00></script></div><div class="col-lg-6 mt-3 mb-3 mx-auto text-center"><a href="https://gitads.dev/v1/ad-track?source=sujithq/sujithq.github.io@github" target=_blank rel=noopener class=d-inline-block><img src="https://gitads.dev/v1/ad-serve?source=sujithq/sujithq.github.io@github" alt="Sponsored by GitAds" class="img-fluid rounded mx-auto d-block"></a></div></div></div><div class="card border-0 mt-3"><div class=card-body><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//sujithq.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div></div></main><footer class=footer><div class="container-fluid bg-primary copyright text-center mt-4"><p>¬© <span>Copyright 2018-Present</span>
<strong class="px-1 sitename">Sujith Quintelier</strong>
<span>All Rights Reserved</span>
‚Ä¢ <a href=/index.xml class=text-white title="RSS Feed"><i class="fas fa-rss"></i> RSS</a></p><p>Based on <a href=https://getbootstrap.com/ rel=nofollow>Bootstrap</a>. Icons from <a href=https://icons.getbootstrap.com/ rel=nofollow>Bootstrap Icons</a> and <a href=https://fontawesome.com/ rel=nofollow>Font Awesome</a>. Web fonts from <a href=https://fonts.google.com/ rel=nofollow>Google</a>.</p></div></footer><a href=# id=scroll-top class="scroll-top d-flex align-items-center justify-content-center active"><i class="fas fa-arrow-up"></i></a><div id=preloader></div><div id=source-modal class="modal fade" tabindex=-1 style=display:none aria-hidden=true><div class="modal-dialog modal-lg"><div class=modal-content><div class=modal-header><h4 class="modal-title me-3">Source Code</h4><button type=button class="btn btn-primary btn-copy"><i class="fas fa-clipboard"></i> Copy Code</button></div><div class=modal-body><pre class=language-html><code></code></pre></div></div></div></div><script>window.HUGO_ENV="";var availableThemes=JSON.parse('["dark","light"]')</script><script src=/vendor/bootstrap/js/bootstrap.bundle.min.e4fd49181388c48ec5040bd3fe66f57c29c8e67fcd8502b3354b96ec7ab47cc7.js integrity="sha256-5P1JGBOIxI7FBAvT/mb1fCnI5n/NhQKzNUuW7Hq0fMc=" crossorigin=anonymous></script><script src=/vendor/aos/js/aos.a5005b2e414770fd5ccb40bc221a12771966d02b5c1f9c89da48bd8e3811d377.js integrity="sha256-pQBbLkFHcP1cy0C8IhoSdxlm0CtcH5yJ2ki9jjgR03c=" crossorigin=anonymous></script><script>function aosInit(){AOS.init({duration:600,easing:"ease-in-out",once:!0,mirror:!1})}window.addEventListener("DOMContentLoaded",aosInit)</script><script src=/vendor/swiper/js/swiper-bundle.min.73203b5c5f70f45b31428e9c82d30645ef407717ed84e732b32f96ab848f0a7f.js integrity="sha256-cyA7XF9w9FsxQo6cgtMGRe9AdxfthOcysy+Wq4SPCn8=" crossorigin=anonymous></script><script src=/vendor/prismjs/js/prism-core.min.6caad316dd991f24f8004e0b9c19c055cb5829ff65e973fbee406f96d81b8e7e.js integrity="sha256-bKrTFt2ZHyT4AE4LnBnAVctYKf9l6XP77kBvltgbjn4=" crossorigin=anonymous></script><script src=/vendor/prismjs/js/prism-autoloader.min.0233342795c86e2079f7406bce72c481918b9ce416aedeb6b37044abae50fc8d.js integrity="sha256-AjM0J5XIbiB590BrznLEgZGLnOQWrt62s3BEq65Q/I0=" crossorigin=anonymous></script><script src=/ts/main.f51f4656145ceb2ef15f082a7588110128f74f3f1c55c9b988e96b2054a44bf2.js integrity="sha256-9R9GVhRc6y7xXwgqdYgRASj3Tz8cVcm5iOlrIFSkS/I=" crossorigin=anonymous></script><script src=https://kit.fontawesome.com/5fc2d9cacb.js crossorigin=anonymous></script><script src=/js/main.6c5e9a54b8d04f61fd138df3018703ea5f5b3fa185314df76ca6c21c786cdcf7.js integrity="sha256-bF6aVLjQT2H9E43zAYcD6l9bP6GFMU33bKbCHHhs3Pc=" crossorigin=anonymous></script><script src=https://analytics.ahrefs.com/analytics.js data-key=zFn6YUC1ofEcLJXv92lDUA async></script><script src=https://d3js.org/d3.v7.min.js></script><script src=/tech-radar/js/radar.2bfc0b17e82f5916016dae4442d156cded838e55a28df36c5408235ed750d405.js integrity="sha256-K/wLF+gvWRYBba5EQtFWze2DjlWijfNsVAgjXtdQ1AU=" crossorigin=anonymous></script><script src=/js/mermaid-init.a08987413c413404b8adfd2826c40349a5e23e0492e868511648790a0b72ef85.js integrity="sha256-oImHQTxBNAS4rf0oJsQDSaXiPgSS6GhRFkh5Cgty74U=" crossorigin=anonymous></script></body></html>